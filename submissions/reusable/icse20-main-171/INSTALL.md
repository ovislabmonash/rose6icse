## INSTALL

  #### 1. Pull the docker image of FPGen artifact and creat, run the FPGen container  
  ```
  $ docker pull ucdavisplse/fpgen-artifact:icse20   
  $ docker run -ti --name=FPGen --cpus=8 --memory=32g ucdavisplse/fpgen-artifact:icse20   
  ```
  Notes:  
  when inside the FPGen container,  
  (1) to exit the FPGen docker container and terminate all running jobs inside the container, use:   
  ```
  $ exit
  ```
  (2) to detach from the running FPGen container without stopping it, 
  ```
  press CTRL+P followed by CTRL+Q
  ```
  when outside the FPGen container and looking to start/attach to it, run: 
  ```
  $ docker start -ai FPGen 
  ```
  #### 2. Clone FPGen github repo. and rename it
  Inside FPGen container, navigate to home directory, clone this repo. and rename it,
  ```
  $ cd
  $ git clone https://github.com/ucd-plse/FPGen.git
  $ mv FPGen FPTesting
  ```
  #### 3. Test FPGen on an example
  Note: you can ignore the example and directly go to the next section if you are only looking to replicating/reproducing the results of FPGen.
  
  navigate to _example_
  ```
  cd /home/fptesting/example; ls
  ```
  We use the recursive summation program that takes an input array of size 4 as an example. There are two c files needed to run FPGen:
  * add-SYMBOLIC.c   : the original program with error injections
  * test/add-INOUT.c : the original program that is modified to read the input array from a file and write the result to the output file, and can be compiled to various precision (float, double, \_\_float128) for error measurement.
  
  (1) compile and symbolically run the test
  ```
  $ ../scripts/compile.sh add-SYMBOLIC
  ```
  This step enables KLEE to explore the error paths and it will take 2~3 minutes. When KLEE finishes, you should see the number of paths KLEE has reached, 
  ```
  KLEE: done: total instructions = 4133
  KLEE: done: completed paths = 84
  KLEE: done: generated tests = 84
  ```
  (2) read the inputs generated by KLEE
  ```
  $ ../scripts/show_tests.sh
  ```
  (3) prepare the executables with multiple precisions 
  ```
  $ cd test
  $ make
  $ ls
  ```
  There are 3 executables: _add-32_ with float precision, _add-64_ with double precision, _add-128_with \_\_float128 precision.
  (4) Measure errors for the generated inputs
  ```
  $ cd ../../example
  $ ../scripts/compute_error.sh "klee-last/test0000*-input" test/add-64 test/add128
  ```
  It measures the errors between double and \_\_float128, and prints out the top 10 error-inducing inputs and the relative error the input triggers like following,
  ```
  Maximum relative error: 5.1607477707e-05 [klee-last/test000084-input].
  ---top 10 inputs
  klee-last/test000084-input -- 5.1607477707e-05
  klee-last/test000080-input -- 2.1288082770e-09
  klee-last/test000064-input -- 5.0207933244e-16
  klee-last/test000077-input -- 1.6766168035e-16
  klee-last/test000072-input -- 1.1026481444e-16
  klee-last/test000067-input -- 1.0747657680e-16
  klee-last/test000079-input -- 1.0714443092e-16
  klee-last/test000066-input -- 8.8272423124e-17
  klee-last/test000082-input -- 4.1739994958e-17
  klee-last/test000063-input -- 6.9408001417e-18
  ```
  The maximum error triggered is `5.1607477707e-05` and the error-inducing input is `klee-last/test000084-input`.
